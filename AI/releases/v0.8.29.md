# TestMe v0.8.29 Release Notes

Released: November 4, 2025

## Bug Fixes

### TESTME_STOP Environment Variable Not Propagating to Tests

Fixed `TESTME_STOP` environment variable not being set correctly when using the `--stop` flag. Tests with test-specific configurations were seeing `TESTME_STOP=0` even when running with `--stop`.

**Root Cause:** The `findConfigForTest()` method in `src/runner.ts` was missing `stopOnFailure` from the list of CLI overrides to preserve during config merging.

**Impact:** Tests can now reliably detect fast-fail mode (e.g., fuzzers can stop early on first crash when `TESTME_STOP=1`).

### --monitor Flag Not Streaming Output in Real-Time

Fixed `--monitor` (`-m`) flag not streaming test output in real-time. Output now appears progressively during execution instead of only after test completion.

**Root Cause:** Config merging in `src/runner.ts` wasn't preserving the `output.live` flag from CLI arguments.

### Configuration Variable Expansion in Inherited Configs

Fixed `${CONFIGDIR}` expansion in parent configurations. Variables are now substituted with the parent's absolute path before inheritance, preventing incorrect paths in child configs.

**Example:**

```json5
// Parent: /web/test/testme.json5
{
    compiler: {
        c: {
            gcc: {
                flags: ['-Wl,-rpath,${CONFIGDIR}/../build/bin'],
            },
        },
    },
}

// Child: /web/test/fuzz/testme.json5 with inherit: ['compiler']
```

**Before:** `${CONFIGDIR}` expanded to `/web/test/fuzz` (child's directory - incorrect)
**After:** `${CONFIGDIR}` expands to `/web/test` (parent's directory - correct)

### Pattern Matching for Subdirectory Paths

Fixed pattern matching for paths with subdirectories. `tm subdir/name` now correctly matches `subdir/name.tst.sh`.

## Enhancements

### Real-Time Test Output Streaming

Added `--monitor` (`-m`) flag to stream test output in real-time to console:

```bash
tm --monitor              # Stream test output
tm -m --verbose           # Combine with verbose for detailed reporting
```

-   Only active in TTY (interactive terminal) mode
-   Automatically disabled when output is piped or redirected
-   Works with all test types

### TESTDIR and CONFIGDIR Now Use Absolute Paths

`${TESTDIR}` and `${CONFIGDIR}` now provide absolute paths instead of relative paths:

-   `${TESTDIR}` expands to absolute path (e.g., `/Users/mob/c/web/test`)
-   `${CONFIGDIR}` expands to absolute path (e.g., `/Users/mob/c/web/test`)
-   Ideal for rpath: `flags: ['-Wl,-rpath,${CONFIGDIR}/../build/${PLATFORM}-${PROFILE}/bin']`

### Enhanced Environment Variables

Added new environment variable exports for services and tests:

-   `TESTME_DEPTH` - Set when `--depth N` is used, otherwise unset
-   `TESTME_ITERATIONS` - Always set (defaults to '1' if `--iterations` not specified)
-   `TESTME_STOP` - Always set to '0' or '1' (based on `--stop` flag)
-   `TESTME_VERBOSE`, `TESTME_QUIET`, `TESTME_KEEP` - Always set to '0' or '1'

## Upgrade Notes

**Breaking Change:**

-   `${TESTDIR}` and `${CONFIGDIR}` now return absolute paths instead of relative paths
-   Most use cases benefit from this change (especially rpath flags)
-   If you relied on relative paths, update your configuration to work with absolute paths

## Previous Release

See [v0.8.28 Release Notes](v0.8.28.md) for the previous release.
