/*
    testme.json5 - Sample TestMe configuration file
 */
{
    /*
        Enable or disable tests in this directory
        Set to false to disable all tests in this directory
     */
    enable: true,

    /*
        Minimum depth required to run tests in this directory (default: 0)
        Use tm --depth N to run tests with depth <= N
     */
    depth: 0,

    /*
         Compiler configuration for different languages
     */
    compiler: {
        c: {
            /*
                Compiler selection has three modes:
                1. Auto-detect (default): compiler: 'default'
                2. Explicit compiler for all platforms: compiler: 'gcc'
                3. Per-platform compiler map:
                compiler: {
                    windows: 'msvc',
                    macosx: 'clang',
                    linux: 'gcc'
                }
            */
            compiler: 'default',

            /*
                GCC-specific flags (Unix/Linux/MinGW)
                Default flags are automatically added: -std=c99 -Wall -Wextra -Wno-unused-parameter -Wno-strict-prototypes -O0 -g -I. -I~/.local/include -L~/.local/lib -I/opt/homebrew/include -L/opt/homebrew/lib

                Platform-specific overrides are supported:
                gcc: {
                    flags: ['-I..'],              // Common flags for all platforms
                    libraries: ['m', 'pthread'],  // Common libraries for all platforms
                    macosx: {
                        flags: ['-framework', 'IOKit'],  // Additional flags for macOS
                        libraries: ['objc'],             // Additional libraries for macOS
                    },
                    linux: {
                        flags: ['-D_GNU_SOURCE'],   // Additional flags for Linux
                        libraries: ['rt'],          // Additional libraries for Linux
                    },
                }
             */
            gcc: {
                flags: [
                    '-I..',
                    '-I${../build/${PLATFORM}-${PROFILE}/inc',
                    '-L${../build/${PLATFORM}-${PROFILE}/bin',
                    '-Wl,-rpath,@executable_path/${CONFIGDIR}/../build/${PLATFORM}-${PROFILE}/bin',
                ],
                libraries: ['m', 'pthread'],
            },

            /*
                Clang-specific flags (macOS/Unix)
                Default flags are automatically added: -std=c99 -Wall -Wextra -Wno-unused-parameter -Wno-strict-prototypes -O0 -g -I. -I~/.local/include -L~/.local/lib -I/opt/homebrew/include -L/opt/homebrew/lib

                Platform-specific overrides are also supported (see gcc example above)
            */
            clang: {
                flags: [
                    '-I..',
                    '-I${../build/${PLATFORM}-${PROFILE}/inc',
                    '-L${../build/${PLATFORM}-${PROFILE}/bin',
                    '-Wl,-rpath,@executable_path/${CONFIGDIR}/../build/${PLATFORM}-${PROFILE}/bin',
                ],
                libraries: ['m', 'pthread'],
            },

            /*
                MSVC-specific flags (Windows)
                Default flags are automatically added: /std:c11 /W4 /Od /Zi /nologo
            */
            msvc: {
                flags: ['/I.', '/I..', '/I${../build/${PLATFORM}-${PROFILE}/inc'],
                libraries: [],
            },
        },
        es: {
            // Ejscript module to require (supports ~ and ${} expansion)
            require: '${~/.local/lib/testme/testme.mod}',
        },
    },

    /*
        Debugger configuration for different languages (use with --debug flag)
     */
    debug: {
        /*
            C debugger selection has three modes:
            1. Auto-detect (default): c: 'default'
            2. Explicit debugger for all platforms: c: 'gdb'
            3. Per-platform debugger map:
               c: {
                   windows: 'vs',      // or 'vscode'
                   macosx: 'xcode',    // or 'lldb'
                   linux: 'gdb'        // or 'lldb', 'vscode'
               }
            Valid C debuggers: xcode, lldb, gdb, vs, vscode, or path to executable
         */
        c: 'default',

        // JavaScript debugger: vscode, or path to executable
        // js: 'vscode',

        // TypeScript debugger: vscode, or path to executable
        // ts: 'vscode',

        // Python debugger: vscode, pdb, or path to executable
        // py: 'vscode',

        // Go debugger: vscode, delve, or path to executable
        // go: 'delve',

        // Ejscript debugger: vscode, or path to executable
        // es: 'vscode',
    },

    // Test execution settings
    execution: {
        timeout: 30000, // Timeout per test in milliseconds
        parallel: true, // Run tests in parallel
        workers: 4, // Number of parallel workers
    },

    // Output formatting options
    output: {
        verbose: false, // Show detailed output
        format: 'simple', // Output format: simple, detailed, json
        colors: true, // Enable colored output
    },

    // File discovery patterns
    patterns: {
        // Base patterns applied to all platforms
        include: ['**/*.tst.c', '**/*.tst.js', '**/*.tst.ts', '**/*.tst.es'],
        exclude: ['**/node_modules/**', '**/.testme/**', '**/.*/**'],

        // Windows-specific patterns (added to base patterns on Windows)
        windows: {
            include: ['**/*.tst.ps1', '**/*.tst.bat', '**/*.tst.cmd'],
        },

        // macOS-specific patterns (added to base patterns on macOS)
        macosx: {
            include: ['**/*.tst.sh'],
        },

        // Linux-specific patterns (added to base patterns on Linux)
        linux: {
            include: ['**/*.tst.sh'],
        },
    },

    // Service management for test setup/teardown
    services: {
        skip: '', // Script to check if tests should be skipped (0=run, non-zero=skip)
        prep: '', // Script to run once before all tests begin (waits for completion)
        setup: '', // Script to start background service during test execution, runs before tests
        cleanup: '', // Script to run after all tests complete for cleanup
        skipTimeout: 30000, // Skip script timeout in milliseconds
        prepTimeout: 30000, // Prep timeout in milliseconds
        setupTimeout: 30000, // Setup timeout in milliseconds
        cleanupTimeout: 10000, // Cleanup timeout in milliseconds
        delay: 0, // Delay in milliseconds after setup before running tests
    },

    // Environment variables to set for test execution
    env: {
        BIN: '${../build/${PLATFORM}-${PROFILE}/bin}',
        HTTP: 'http://localhost:4100',
    },
}
